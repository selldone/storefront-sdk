<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selldone List of Products - Vue3 + Vuetify Example</title>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.6.6/dist/vuetify.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Material+Icons" rel="stylesheet">

    <!-- 🏬 Specify the shop's name -->
    <meta name="shop-name" content="toysworld">

    <!-- 🎗 Set the app's prefix address, for example: /my-shop-path -->
    <meta name="shop-prefix-address" content="">

    <!-- 📰 Define a custom homepage for the shop -->
    <meta name="custom-home" content="shop">


    <!-- ―――――――――――――――― Start ❯ Business OS Configuration ―――――――――――――――― -->

    <!-- 🪁 Service Origin -->
    <meta content="https://selldone.com" name="service-url">


    <!-- 🎯 APIs -->
    <meta content="https://gapi.selldone.com" name="selldone-gapi">
    <meta content="https://xapi.selldone.com" name="selldone-xapi">
    <meta content="https://iframe.selldone.com" name="selldone-iframe">
    <meta content="https://capi.selldone.com" name="selldone-capi">

    <!-- 🌍 CDNs -->
    <meta content="https://selldone.com/cdn-shop-images-1" name="selldone-cdn-images">
    <meta content="https://selldone.com/cdn-shop-jsons-1" name="selldone-cdn-jsons">
    <meta content="https://selldone.com/cdn-videos" name="selldone-cdn-videos">
    <meta content="https://selldone.com/cdn-shop-temp-files" name="selldone-cdn-temp-files">
    <meta content="https://selldone.com/cdn-ar" name="selldone-cdn-ar">
    <meta content="https://selldone.com/cdn-id" name="selldone-cdn-id">
    <meta content="true" name="storage-redirect">
    <meta content="https://cdn.selldone.com" name="storage-redirect-host">
    <meta content="true" name="storage-redirect-thumbnails">


</head>

<body>
<div class="my-5 pa-3">
    <h1>Product Listings</h1>
    <p>This project displays a scrollable list of discounted products alongside a material design sidebar.</p>
    <p>
        <b>Platform:</b> <a href="https://selldone.com">https://selldone.com</a><br>
        <b>SDK:</b> <a href="https://github.com/selldone/storefront-sdk">https://github.com/selldone/storefront-sdk</a>
    </p>
</div>

<div class="pa-3">
    <h2>How It Works:</h2>
    <ol class="mx-6">
        <li>Load Vue3 and Vuetify to utilize components such as <code>v-btn</code>, <code>v-row</code>, and others.</li>
        <li>Load the Storefront SDK script to access Selldone's storefront APIs, enabling product data retrieval through <code>window.$storefront.products.fetchProducts(...)</code>.</li>
        <li>Fetch product data from the store identified as 'toysworld', configured via meta tags like <code>&lt;meta name="shop-name" content="toysworld"&gt;</code>.</li>
    </ol>

</div>

<div id="app">
    <v-app>

        <v-sheet color="#ef3c51" style="overflow-x: auto;width: 100%" class="my-5 py-3 py-sm-5 mx-auto" :style="$vuetify.display.xlAndUp?'border-radius:2rem;max-width:1720px;':''">
            <v-container fluid>
                <v-row class="flex-nowrap" align="stretch">
                    <v-col style="min-width: 200px;max-width: 200px" class="text-center d-flex flex-column align-center">
                        <v-spacer></v-spacer>
                       <div>
                           <h4 class="my-3 text-h4">Incredible Offer Deal</h4>

                           <v-img src="https://cdn.selldone.com/app/shops/115/pages/1926/images/confettisvg967788a152da6f5a63ca8fef86119157.svg"
                                  height="100px" width="100px" class="mx-auto my-3"></v-img>
                       </div>
                        <v-spacer></v-spacer>
                            <v-btn color="#fff" variant="text" :href="`/?search=*&sort=most_popular&filter=${JSON.stringify({only_has_discount:true})}`">More Info
                                <span class="material-icons">chevron_right</span>
                            </v-btn>
                    </v-col>
                    <v-col v-for="(product, index) in products" :key="index" class="pa-1" >
                            <v-card
                                    style="width: 200px;min-height: 320px;height: 100%"
                                    :rounded="index==0?'s-xl':undefined"
                                    flat>
                                <v-img :src="getImageUrl(product.icon)" height="200px"></v-img>
                                <div class="d-flex justify-space-between pa-2">
                                    <b>{{ product.price }}
                                        {{ product.currency }}</b>
                                    <v-chip color="red" size="x-small" variant="flat">
                                        {{Math.round(100*(product.discount)/(product.price))}}%
                                    </v-chip>
                                </div>
                                <v-card-text class="text-wrap">{{ product.title }}</v-card-text>

                            </v-card>
                    </v-col>
                    <v-col  class="pa-1" >
                        <v-card
                                style="width: 200px;min-height: 320px;height: 100%"
                                rounded="e-xl" class="d-flex flex-column align-center justify-center"
                                flat
                                :href="`/?search=*&sort=most_popular&filter=${JSON.stringify({only_has_discount:true})}`"
                        >

                            <div style="height: 56px;width: 56px;border-radius: 50%;border: solid thin #eee" class="d-flex align-center justify-center">
                                <span class="material-icons">trending_flat</span>
                            </div>

                            <div class="mt-5">
                                View All
                            </div>

                        </v-card>
                    </v-col>
                </v-row>
            </v-container>
        </v-sheet>
    </v-app>



</div>

<!-- Vue 3 -->
<script src="https://unpkg.com/vue@3"></script>
<!-- Vuetify JS (Ensure this is loaded after Vue) -->
<script src="https://cdn.jsdelivr.net/npm/vuetify@3.6.6/dist/vuetify.js"></script>
<!-- Selldone SDK -->
<script src="https://cdn.jsdelivr.net/npm/@selldone/sdk-storefront@1.0.12/dist/bundle.min.js"></script>

<script>
    const {createApp, h} = Vue;

    document.addEventListener('DOMContentLoaded', function () {
        const app = createApp({
            data() {
                return {

                    products: [],
                    folders: []
                };
            },
            methods: {
                fetchProducts(dir, more, limit, options) {
                    window.$storefront.products
                        .optimize(600) // Cache products for 600 seconds
                        .fetchProducts(dir, more ? this.products.length : 0, limit, options)
                        .then(({products, folders}) => {
                            this.products = products;
                            this.folders = folders;
                        })
                        .catch((error) => {
                            console.error("Failed to fetch products:", error);
                        });
                },
                getImageUrl(path, size) {
                    return window.CDN.GET_SHOP_IMAGE_PATH(path, size)
                }
            },
            created() {
                const sdk = storefront.StorefrontSDK;
                sdk.Setup();

                this.fetchProducts('*', false, 10, {
                    categories_count: 10,
                    with_parent: true,
                    with_page: true,
                    sort: 'random',
                    available: false,
                    search: null,
                    search_type: null,
                    dirs: null,
                    filter: JSON.stringify({only_has_discount:true}),
                    products_only: false,
                    categories_only: false,
                    with_total: true,
                    bounds: null,
                    tags: null,
                    vendor_id: null,
                    surrounded: false
                })
            }
        });

        const {createVuetify} = Vuetify;
        const vuetify = createVuetify({});
        app.use(vuetify);
        app.mount('#app');
    });

</script>
</body>

</html>
